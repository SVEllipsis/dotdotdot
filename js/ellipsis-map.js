window.ellipsisMap=function(){"use strict";var t=function(t,a){this.currentJourneyId=a,this.getData(this.currentJourneyId).done($.proxy(function(a){this.data=a.data;var e={center:new google.maps.LatLng(45,10),zoom:5};if(this.data.length){var n=this.data[this.data.length-1];if(e.zoom=9,this.data.length>=2){var o=this.data[this.data.length-2];e.center=new google.maps.LatLng(this._meanValue(n.lat,o.lat),this._meanValue(n["long"],o["long"]))}else e.center=new google.maps.LatLng(n.lat,n["long"])}this.map=new google.maps.Map(t,e),this.addMarkers(),this.addLine()},this))};return t.prototype={getData:function(t){return $.ajax("//data.ellipsis.voyage/data.json",{data:{order:"id:asc",journey_id:t}})},addMarkers:function(){var t=this.map,a=[];for(var e in this.data){var n=this.data[e],o=new Date(n.created_at),i=new google.maps.Marker({position:new google.maps.LatLng(n.lat,n["long"]),animation:google.maps.Animation.DROP,title:this.formatDate(o)});this.buildAndAttachInfoWindow(i,n),a.push(i)}for(e in a)this.dropMarkerOntoMap(a[e],t)},addLine:function(){var t=[];for(var a in this.data)t.push(new google.maps.LatLng(this.data[a].lat,this.data[a]["long"]));var e=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW},repeat:"100px",offset:"30px"}]});e.setMap(this.map)},buildAndAttachInfoWindow:function(t,a){var e=new Date(a.created_at),n='<div class="map__info"><h2>'+this.formatDate(e)+"</h2><ul><li>Bearing: "+a.bearing+'</li><li>Coordinates: <span class="map__info__coordinates">'+a.lat+", "+a["long"]+"</span></li></ul></div>",o=new google.maps.InfoWindow({content:n});google.maps.event.addListener(t,"click",function(){o.open(t.getMap(),t)})},dropMarkerOntoMap:function(t,a){t.setMap(a)},formatDate:function(t){return t.getUTCFullYear()+"-"+this._zeroPad(t.getUTCMonth()+1)+"-"+this._zeroPad(t.getUTCDate())+" "+this._zeroPad(t.getUTCHours())+":"+this._zeroPad(t.getUTCMinutes())},_zeroPad:function(t){return 10>t?"0"+t:t},_meanValue:function(){for(var t=0,a=0;a<arguments.length;a++)t+=arguments[a];return t/arguments.length}},t}();